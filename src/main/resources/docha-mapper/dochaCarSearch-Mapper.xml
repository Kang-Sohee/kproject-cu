<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ohdocha.cu.kprojectcu.mapper.DochaCarSearchDao">


    <select id="selectCarSearchDetail" parameterType="DochaMap" resultType="DochaCarSearchPaymentDetailDto">
        <![CDATA[
				SELECT
				    /*START DC_CAR_INFO*/
				    IFNULL(T1.CR_IDX                  , '' ) AS CR_IDX                   /*차량idx*/
				     ,	IFNULL(T1.MD_IDX                  , '' ) AS MD_IDX                   /*모델idx*/
				     ,	IFNULL(T1.RT_IDX                  , '' ) AS RT_IDX                   /*제휴사idx*/
				     ,	IFNULL(T1.MODEL_NAME              , '' ) AS MODEL_NAME               /*모델명*/
				     ,	IFNULL(T1.MODEL_DETAIL_NAME       , '' ) AS MODEL_DETAIL_NAME        /*모델상세명*/
				     ,	IFNULL(T1.FUEL_CODE               , '' ) AS FUEL_CODE                /*연료구분code*/
				     ,	IFNULL(T1.TRANSMISSION_CODE       , '' ) AS TRANSMISSION_CODE        /*변속기구분code*/
				     ,	IFNULL(T1.DRIVE_TYPE_CODE         , '' ) AS DRIVE_TYPE_CODE          /*구동방식구분code*/
				     ,	IFNULL(T1.CARTYPE_CODE            , '' ) AS CARTYPE_CODE             /*차종code*/
				     ,	IFNULL(T1.DRIVE_LICENSE_CODE      , '' ) AS DRIVE_LICENSE_CODE       /*면허구분code*/
				     ,	IFNULL(T1.MANUFACTURER_CODE       , '' ) AS MANUFACTURER_CODE        /*제조사code*/
				     ,	IFNULL(T1.COLOR_NAME              , '' ) AS COLOR_NAME               /*색상*/
				     ,	IFNULL(T1.DISPLACEMENT            , '' ) AS DISPLACEMENT             /*배기량*/
				     ,	IFNULL(T1.YEAR                    , '' ) AS YEAR                     /*연식*/
				     ,	IFNULL(T1.MILEAGE                 , '' ) AS MILEAGE                  /*주행거리*/
				     ,	IFNULL(T1.MAXIMUM_PASSENGER       , '' ) AS MAXIMUM_PASSENGER        /*승차인원*/
				     ,	IFNULL(T1.PY_IDX                  , '' ) AS PY_IDX                   /*요금idx*/
				     ,	IFNULL(T3.DAILY_STANDARD_PAY      , '' ) AS DAILY_STANDARD_PAY       /*일기본요금*/
				     ,	IFNULL(T3.MONTHLY_STANDARD_PAY    , '' ) AS MONTHLY_STANDARD_PAY     /*월기본요금*/
				     ,	IFNULL(T1.LONGTERM_DEPOSIT        , '' ) AS LONGTERM_DEPOSIT         /*장기대여보증금*/
				     ,	IFNULL(T1.CAR_STATUS_CODE         , '' ) AS CAR_STATUS_CODE          /*차량상태code*/
				     ,	IFNULL(T1.RESERVE_ABLE_YN         , '' ) AS RESERVE_ABLE_YN          /*차량예약가능여부code*/
				     ,	IFNULL(T1.CAR_REG_DT              , '' ) AS CAR_REG_DT               /*차량등록일*/
				     ,	IFNULL(T1.CAR_NUMBER              , '' ) AS CAR_NUMBER               /*차량번호*/
				     ,	IFNULL(T1.CAR_CHASSIS_NUMBER      , '' ) AS CAR_CHASSIS_NUMBER       /*차대번호*/
	     		     ,	IFNULL(T1.CAR_DRIVE_LIMIT         , '' ) AS CAR_DRIVE_LIMIT          /*주행거리제한*/
	     		     ,	IFNULL(T1.GARAGE_ADDR             , '' ) AS GARAGE_ADDR               /*차고지주소*/
					 ,	IFNULL(T1.CAR_ETC                 , '' ) AS CAR_ETC                   /*비고*/
					 ,	IFNULL(T1.IMG_IDX                 , '' ) AS IMG_IDX                   /*비고*/
	     		     ,	IFNULL(T3.DAILY_MAX_RATE          , '' ) AS DAILY_MAX_RATE				/*일대여최대할인율*/
				     ,	IFNULL(T3.MONTHLY_MAX_RATE        , '' ) AS MONTHLY_MAX_RATE           /*월대여최대할인율*/
				     ,	IFNULL(T3.MONTH3_DEPOSIT          , '' ) AS MONTH3_DEPOSIT             /*3개월보증금*/
				     ,	IFNULL(T3.MONTH6_DEPOSIT          , '' ) AS MONTH6_DEPOSIT             /*6개월보증금*/
				     ,	IFNULL(T3.MONTH9_DEPOSIT          , '' ) AS MONTH9_DEPOSIT             /*9개월보증금*/
				     ,	IFNULL(T3.MONTH12_DEPOSIT         , '' ) AS MONTH12_DEPOSIT            /*12개월보증금*/
				     ,	IFNULL(T3.DELIVERY_STANDARD_PAY   , '' ) AS DELIVERY_STANDARD_PAY      /*배달기본요금*/
				     ,	IFNULL(T3.DELIVERY_ADD_PAY        , '' ) AS DELIVERY_ADD_PAY           /*배달10KM단위추가요금*/
				     ,	IFNULL(T3.DELIVERY_MAX_RATE       , '' ) AS DELIVERY_MAX_RATE          /*배달최대할인율*/
				     ,	IFNULL(T3.DAILY_YN                , '' ) AS DAILY_YN                   /*일대여사용유무*/
				     ,	IFNULL(T3.MONTHLY_YN              , '' ) AS MONTHLY_YN                 /*월대여사용유무*/
				     ,	IFNULL(T3.CLOSEDVEHICLE_YN        , '' ) AS CLOSEDVEHICLE_YN           /*휴차일사용유무*/
				     ,	IFNULL(T1.CI_IDX                  , '' ) AS CI_IDX                     /*보험정보idx*/
-- 				     ,	IFNULL(T1.PER_IDX                 , '' ) AS PER_IDX                    /*기간요금idx*/
				    /*END DC_CAR_INFO*/

	     	        ,	IFNULL(T2.INSURANCE_FEE        , '' ) AS INSURANCE_FEE                  /*보험요금*/
-- 				    ,	IFNULL(T2.INSURANCE_FEE2        , '' ) AS INSURANCE_FEE2                  /*보험요금2*/
-- 				    ,	IFNULL(T2.INSURANCE_FEE3        , '' ) AS INSURANCE_FEE3                  /*보험요금3*/
-- 				    ,	IFNULL(T2.INSURANCE_FEE4        , '' ) AS INSURANCE_FEE4                  /*보험요금4*/
				     ,	IFNULL(T2.ONSELF_DAMAGE_COVER  , '' ) AS ONSELF_DAMAGE_COVER            /*자손보상금액*/
				     ,	IFNULL(T2.PERSONAL_COVER       , '' ) AS PERSONAL_COVER                 /*대인보상금액*/
				     ,	IFNULL(T2.PROPERTY_DAMAGE_COVER, '' ) AS PROPERTY_DAMAGE_COVER          /*대물보상금액*/
				     ,	IFNULL(T2.AGE_LIMIT            , '' ) AS AGE_LIMIT                      /*연령제한(장기,단기)*/
				     ,	IFNULL(T2.DRIVE_CAREER_LIMIT   , '' ) AS DRIVE_CAREER_LIMIT             /*운전경력제한*/
				     ,	IFNULL(T2.CAR_DAMAGE_COVER     , '' ) AS CAR_DAMAGE_COVER               /*자차보상금액(면책금)*/
				     ,	IFNULL(T2.CAR_DAMAGE_COVER2    , '' ) AS CAR_DAMAGE_COVER2              /*자차보상금액2*/
				     ,	IFNULL(T2.CAR_DAMAGE_COVER3    , '' ) AS CAR_DAMAGE_COVER3              /*자차보상금액3*/
				     ,	IFNULL(T2.CAR_DAMAGE_COVER4    , '' ) AS CAR_DAMAGE_COVER4              /*자차보상금액4*/
				     ,	IFNULL(T2.INSURANCE_COPAYMENT  , '' ) AS INSURANCE_COPAYMENT            /*고객부담금(보험료)*/
				     ,	IFNULL(T2.INSURANCE_COPAYMENT2 , '' ) AS INSURANCE_COPAYMENT2           /*고객부담금2*/
				     ,	IFNULL(T2.INSURANCE_COPAYMENT3 , '' ) AS INSURANCE_COPAYMENT3           /*고객부담금3*/
				     ,	IFNULL(T2.INSURANCE_COPAYMENT4 , '' ) AS INSURANCE_COPAYMENT4           /*고객부담금4*/
				     ,	IFNULL(T2.CAR_DAMAGE1_YN       , 'Y' ) AS CAR_DAMAGE1_YN                 /*자차1사용유무*/
				     ,	IFNULL(T2.CAR_DAMAGE2_YN       , 'N' ) AS CAR_DAMAGE2_YN                 /*자차2사용유무*/
				     ,	IFNULL(T2.CAR_DAMAGE3_YN       , 'N' ) AS CAR_DAMAGE3_YN                 /*자차3사용유무*/
				     ,	IFNULL(T2.CAR_DAMAGE4_YN       , 'N' ) AS CAR_DAMAGE4_YN                 /*자차4사용유무*/
				     ,	IFNULL(T2.CI_ETC               , '' ) AS CI_ETC                         /*비고(템플릿제목)*/

	    /*START DC_RENT_COMPANY*/
				     ,	IFNULL(T4.COMPANY_NAME         , '' ) AS COMPANY_NAME                   /*회원사 이름*/
				     ,	IFNULL(T4.COMPANY_CONTACT1     , '' ) AS COMPANY_CONTACT1               /*회원사 연락처1*/
				     ,	IFNULL(T4.COMPANY_ZIPCODE      , '' ) AS COMPANY_ZIPCODE                /*회원사 우편번호*/
				     ,	IFNULL(T4.COMPANY_ADDRESS      , '' ) AS COMPANY_ADDRESS                /*회원사 주소 */
				     ,	IFNULL(T4.COMPANY_ADDRESS_DETAIL      , '' ) AS COMPANY_ADDRESS_DETAIL                /*회원사 상세 주소 */
				     ,	IFNULL(T4.BRANCH_NAME      , '' ) AS BRANCH_NAME                /*회원사 주소 */
-- 				     ,   IFNULL(T3.RENT_FEE				, '0') AS RENT_FEE			             /*대여금*/
-- 				     ,   IFNULL(T3.DIS_RENT_FEE         , '0') AS DIS_RENT_FEE                   /*할인 후 대여금*/
-- 				     ,   IFNULL(T3.MM_RENT_FEE          , '0') AS MM_RENT_FEE                    /*장기 월 대여요금*/
-- 				     ,   IFNULL(T3.MM_LAST_RENT_FEE     , '0') AS MM_LAST_RENT_FEE               /*장기 마지막월 대여요금*/
                    ,      IFNULL(GROUP_CONCAT(T5.OPTION_DETAIL_CODE), '') AS OPTION_DETAIL_CODE
				     	 FROM DC_CAR_INFO T1
				LEFT JOIN DC_CAR_INFO_INSURANCE T2
					   ON T1.CR_IDX = T2.CR_IDX
				LEFT OUTER JOIN DC_PAYMENT_INFO T3
                	   ON T1.CR_IDX = T3.CR_IDX
                	   OR T2.CR_IDX  =T3.CR_IDX
                LEFT JOIN DC_RENT_COMPANY T4
                       ON T1.RT_IDX = T4.RT_IDX
                LEFT JOIN DC_CAR_INFO_OPTION T5
                       ON T1.CR_IDX = T5.CR_IDX
         ]]>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="crIdx != null and crIdx != ''">
                <![CDATA[ T1.CR_IDX = #{crIdx} ]]>
            </if>
        </trim>

        <!-- DC_CAR_INFO 의 IMG_IDX 삭제 DC_IMG_INFO에 CR_IDX추가함
         ,	IFNULL(T1.IMG_IDX                 , '' ) AS IMG_IDX                  /*이미지idx*/
      -->
    </select>

    <select id="selectTargetCarList" parameterType="DochaMap" resultType="DochaCarInfoDto">
   		<![CDATA[

                        SELECT
                        T1.*,
            IFNULL(T4.DELIVERY_ABLE, 0) AS DELIVERY_ABLE,
            IFNULL(T5.VISIT_ABLE, 0) AS VISIT_ABLE
                FROM (
                         SELECT A.CR_IDX                            AS CR_IDX
                              , A.MD_IDX                            AS MD_IDX
                              , A.RT_IDX                            AS RT_IDX
                              , IFNULL(A.MODEL_NAME, '')            AS MODEL_NAME
                              , IFNULL(A.MODEL_DETAIL_NAME, '')     AS MODEL_DETAIL_NAME
                              , IFNULL(A.FUEL_CODE, '')             AS FUEL_CODE
                              , IFNULL(A.TRANSMISSION_CODE, '')     AS TRANSMISSION_CODE
                              , IFNULL(A.DRIVE_TYPE_CODE, '')       AS DRIVE_TYPE_CODE
                              , IFNULL(A.CARTYPE_CODE, '')          AS CARTYPE_CODE
                              , IFNULL(A.DRIVE_LICENSE_CODE, '')    AS DRIVE_LICENSE_CODE
                              , IFNULL(A.MANUFACTURER_CODE, '')     AS MANUFACTURER_CODE
                              , IFNULL(A.COLOR_NAME, '')            AS COLOR_NAME
                              , IFNULL(A.DISPLACEMENT, '')          AS DISPLACEMENT
                              , IFNULL(A.YEAR, '')                  AS YEAR
                              , IFNULL(A.MILEAGE, '')               AS MILEAGE
                              , IFNULL(A.MAXIMUM_PASSENGER, '')     AS MAXIMUM_PASSENGER
                              , IFNULL(A.PY_IDX, '')                AS PY_IDX
                              , IFNULL(A.SHORTTERM_FEE, '')         AS SHORTTERM_FEE
                              , IFNULL(A.LONGTERM_FEE, '')          AS LONGTERM_FEE
                              , IFNULL(A.LONGTERM_DEPOSIT, '')      AS LONGTERM_DEPOSIT
                              , IFNULL(A.CAR_STATUS_CODE, '')       AS CAR_STATUS_CODE
                              , IFNULL(A.RESERVE_ABLE_YN, '')       AS RESERVE_ABLE_YN
                              , IFNULL(A.CAR_REG_DT, '')            AS CAR_REG_DT
                              , IFNULL(A.CAR_NUMBER, '')            AS CAR_NUMBER
                              , IFNULL(A.CAR_CHASSIS_NUMBER, '')    AS CAR_CHASSIS_NUMBER
                              , IFNULL(A.CAR_DRIVE_LIMIT, '')       AS CAR_DRIVE_LIMIT
                              , IFNULL(A.AGE_LIMIT, '')             AS AGE_LIMIT
                              , IFNULL(A.GARAGE_ADDR, '')           AS GARAGE_ADDR
                              , IFNULL(A.CAR_ETC, '')               AS CAR_ETC
                              , IFNULL(A.REG_ID, '')                AS REG_ID
                              , IFNULL(A.REG_DT, '')                AS REG_DT
                              , IFNULL(A.DEL_YN, '')                AS DEL_YN
                              , IFNULL(A.DAILY_YN, '')                AS DAILY_YN
                              , IFNULL(A.MONTHLY_YN, '')                AS MONTHLY_YN
                              , IFNULL(T3.DAILY_STANDARD_PAY, '')   AS DAILY_STANDARD_PAY
                              , IFNULL(T3.MONTHLY_STANDARD_PAY, '') AS MONTHLY_STANDARD_PAY
                              , IFNULL(T3.DAILY_MAX_RATE, '')             AS DAILY_MAX_RATE
                              , IFNULL(T3.MONTHLY_MAX_RATE, '')             AS MONTHLY_MAX_RATE
                              , IFNULL(A.CI_IDX, '')                AS CI_IDX
                              , IFNULL(A.IMG_IDX, '')               AS IMG_IDX
                              , IFNULL(A.PER_IDX, '')               AS PER_IDX
                              , IFNULL(T2.COMPANY_NAME, '')         AS COMPANY_NAME
                              , IFNULL(T2.COMPANY_ADDRESS, '')      AS COMPANY_ADDRESS
                              , IFNULL(T2.BRANCH_NAME, '')          AS BRANCH_NAME
                              , IFNULL(GROUP_CONCAT(T4.OPTION_DETAIL_CODE), '') AS OPTION_DETAIL_CODE
                         FROM DC_CAR_INFO A
                                  LEFT OUTER JOIN DC_RENT_COMPANY T2
                                                  ON A.RT_IDX = T2.RT_IDX

                                  LEFT OUTER JOIN DC_PAYMENT_INFO T3
                                                  ON A.CR_IDX = T3.CR_IDX

                                  LEFT OUTER JOIN DC_CAR_INFO_OPTION T4
                                                  ON A.CR_IDX = T4.CR_IDX

                         WHERE (A.DEL_YN NOT IN('Y') OR A.DEL_YN IS NULL)
                                              AND
                                              (CASE WHEN #{longTermYn} = 'ST' THEN
                                                        T3.DAILY_STANDARD_PAY IS NOT NULL
                                                        AND  T3.DAILY_STANDARD_PAY != '0'
                                                        AND  T3.DAILY_STANDARD_PAY != ''

                                                ELSE T3.MONTHLY_STANDARD_PAY IS NOT NULL
                                                AND T3.MONTHLY_STANDARD_PAY != '0'
                                                AND T3.MONTHLY_STANDARD_PAY != '' END)
                                              AND  INSTR(#{carTypeCodeList} , A.CARTYPE_CODE) > 0
                                              AND  INSTR(#{manufacturerCodeList} , A.MANUFACTURER_CODE) > 0
                                              AND  INSTR(#{yearList} , A.YEAR) > 0
                                              AND  (
                                              T2.COMPANY_ADDRESS LIKE   '%' #{addr1} '%'
                                                                    OR     T2.COMPANY_ADDRESS LIKE  '%'  #{addr2} '%'
                                                                    OR     T2.COMPANY_ADDRESS LIKE  '%'  #{addr3} '%' )
                           GROUP BY CR_IDX

                     ) T1
                         INNER JOIN (
                    SELECT B1.RT_IDX
                    FROM DC_RENT_COMPANY B1
                             INNER JOIN
                         DC_RENT_COMPANY_TIME B2
                         ON B1.RT_IDX = B2.RT_IDX
                      AND NOT EXISTS(
                            SELECT *
                            FROM (
                                     SELECT RT_IDX
                                     FROM DC_RENT_COMPANY_RESERVE_MIN
                                     WHERE ((MINIMUM_START_DT <= #{startDate}
                                         AND MINIMUM_END_DT >= #{startDate})
                                         OR (MINIMUM_START_DT <= #{endDate}
                                             AND MINIMUM_END_DT >= #{endDate}))
                                       AND #{calHour} < MINIMUM_TIME
                                 ) S2
                            WHERE B1.RT_IDX = S2.RT_IDX
                        )

                      AND NOT EXISTS(
                            SELECT *
                            FROM (
                                     SELECT RT_IDX
                                     FROM DC_HOLIDAYS
                                     WHERE ((HOLIDAY_START_DT <= #{startDate}
                                         AND HOLIDAY_END_DT >= #{startDate})
                                         OR (HOLIDAY_START_DT <= #{endDate}
                                             AND HOLIDAY_END_DT >= #{endDate}))
                                       AND CR_IDX IS NULL
                                     GROUP BY RT_IDX
                                 ) S3
                            WHERE B1.RT_IDX = S3.RT_IDX
                        )
                      AND NOT EXISTS(
                            SELECT *
                            FROM (
                                     SELECT RT_IDX
                                     FROM DC_HOLIDAYS
                                     WHERE ((HOLIDAY_START_DT <= #{startDate}
                                         AND HOLIDAY_END_DT >= #{startDate})
                                         OR (HOLIDAY_START_DT <= #{endDate}
                                             AND HOLIDAY_END_DT >= #{endDate}))
                                       AND RT_IDX = 'all'
                                     GROUP BY RT_IDX
                                 ) S4
                            WHERE S4.RT_IDX = 'all'
                        )
                ) T3
                                    ON T1.RT_IDX = T3.RT_IDX

                LEFT OUTER JOIN (SELECT B1.RT_IDX, 1 AS DELIVERY_ABLE
                    FROM DC_RENT_COMPANY B1
                        INNER JOIN
                         DC_RENT_COMPANY_TIME B2
                         ON B1.RT_IDX = B2.RT_IDX
                         LEFT OUTER JOIN DC_RENT_COMPANY_ABLEAREA B3
                         ON B1.RT_IDX = B3.RT_IDX

                    WHERE (
                                      (CASE
                                           WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKEND_DELIVERY_START
                                           ELSE B2.WEEKDAY_DELIVERY_START END) <= #{startTime} AND
                                      (CASE
                                           WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKDAY_DELIVERY_END
                                           ELSE B2.WEEKEND_DELIVERY_END END) >= #{startTime} AND
                                      (CASE
                                           WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKEND_DELIVERY_START
                                           ELSE B2.WEEKDAY_DELIVERY_START END) <= #{endTime}
                                  AND (CASE
                                           WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKDAY_DELIVERY_END
                                           ELSE B2.WEEKEND_DELIVERY_END END) >= #{endTime})
                                AND ( CASE WHEN #{longTermYn} = 'ST' THEN

                            (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND (B3.ADDR_DEPTH2 LIKE    '' OR B3.ADDR_DEPTH2 LIKE '전체')
                                    AND B3.ADDR_DEPTH3 LIKE   ''  AND B3.ADDR_DEPTH4 LIKE    '' AND B3.RA_GBN_CODE = 'S'   )

                                 OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND (B3.ADDR_DEPTH3 LIKE '' OR B3.ADDR_DEPTH3 LIKE '전체')  AND B3.ADDR_DEPTH4 LIKE    '' AND B3.RA_GBN_CODE = 'S'   )

                            OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND B3.ADDR_DEPTH3 LIKE  '%' #{addr3} '%'  AND (B3.ADDR_DEPTH4 LIKE '' OR B3.ADDR_DEPTH4 LIKE '전체')  AND B3.RA_GBN_CODE = 'S'  )

                            OR     (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE   '%' #{addr2} '%'
                                AND B3.ADDR_DEPTH3 LIKE   '%' #{addr3} '%' AND B3.ADDR_DEPTH4 LIKE   '%' #{addr4} '%' AND B3.RA_GBN_CODE = 'S'    )


                                ELSE
                                 (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND (B3.ADDR_DEPTH2 LIKE  '' OR B3.ADDR_DEPTH2 LIKE '전체')
                                    AND B3.ADDR_DEPTH3 LIKE   ''  AND B3.ADDR_DEPTH4 LIKE    '' AND B3.RA_GBN_CODE = 'L'    )

                                 OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND (B3.ADDR_DEPTH3 LIKE '' OR B3.ADDR_DEPTH3 LIKE '전체')  AND B3.ADDR_DEPTH4 LIKE    ''  AND B3.RA_GBN_CODE = 'L'  )

                            OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND B3.ADDR_DEPTH3 LIKE  '%' #{addr3} '%'  AND (B3.ADDR_DEPTH4 LIKE '' OR B3.ADDR_DEPTH4 LIKE '전체')  AND B3.RA_GBN_CODE = 'L'  )

                            OR     (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE   '%' #{addr2} '%'
                                AND B3.ADDR_DEPTH3 LIKE   '%' #{addr3} '%' AND B3.ADDR_DEPTH4 LIKE   '%' #{addr4} '%' AND B3.RA_GBN_CODE = 'L'   )
                                 END
                )

                ) T4 ON T1.RT_IDX = T4.RT_IDX

                LEFT OUTER JOIN (
                    SELECT B1.RT_IDX, 1 AS VISIT_ABLE
                    FROM DC_RENT_COMPANY B1
                             INNER JOIN
                         DC_RENT_COMPANY_TIME B2
                         ON B1.RT_IDX = B2.RT_IDX
                    WHERE (
                                      (CASE
                                           WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKEND_OPEN_START
                                           ELSE B2.WEEKDAY_OPEN_START END) <= #{startTime} AND
                                      (CASE WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKDAY_OPEN_END ELSE B2.WEEKEND_OPEN_END END) >=
                                      #{startTime} AND
                                      (CASE
                                           WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKEND_OPEN_START
                                           ELSE B2.WEEKDAY_OPEN_START END) <= #{endTime}
                                  AND (CASE WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKDAY_OPEN_END ELSE B2.WEEKEND_OPEN_END END) >=
                                      #{endTime})
                ) T5 ON T1.RT_IDX = T5.RT_IDX

                WHERE (DELIVERY_ABLE = 1 OR VISIT_ABLE = 1) AND  T1.CR_IDX NOT IN (SELECT *
                        FROM (
                                 SELECT CR_IDX
                                 FROM DC_HOLIDAYS
                                 WHERE ((HOLIDAY_START_DT <= #{startDate}
                                     AND HOLIDAY_END_DT >= #{startDate})
                                     OR (HOLIDAY_START_DT <= #{endDate}
                                         AND HOLIDAY_END_DT >= #{endDate}))
                                 GROUP BY CR_IDX
                             ) S1
                        WHERE S1.CR_IDX = T1.CR_IDX
                    )

                  AND T1.CR_IDX NOT IN (
                        SELECT CR_IDX
                        FROM (
                                 SELECT C1.CR_IDX
                                      , DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_START_DAY, ' ', RENT_START_TIME), '%Y-%m-%d %H:%i'),
                                                    '%Y-%m-%d %H:%i') AS START_DT
                                      , CASE
                                            WHEN C1.DELIVERY_TYPE_CODE = 'OF'
                                                THEN ADDTIME(
                                                    DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_END_DAY, ' ', RENT_END_TIME), '%Y-%m-%d %H:%i'),
                                                                '%Y-%m-%d %H:%i'), STR_TO_DATE(C2.RETURN_INSPECTION_TIME, '%H'))
                                            ELSE
                                                CASE
                                                    WHEN DAYOFWEEK(C1.RENT_END_DAY) = 1 OR 7
                                                        THEN ADDTIME(DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_END_DAY, ' ', RENT_END_TIME),
                                                                                             '%Y-%m-%d %H:%i'), '%Y-%m-%d %H:%i'),
                                                                     STR_TO_DATE(C2.WEEKEND_ABLE_DELIVERY_TIME, '%H'))
                                                    ELSE ADDTIME(DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_END_DAY, ' ', RENT_END_TIME),
                                                                                         '%Y-%m-%d %H:%i'), '%Y-%m-%d %H:%i'),
                                                                 STR_TO_DATE(C2.WEEKDAY_ABLE_DELIVERY_TIME, '%H')) END
                                     END                              AS END_DT

                                 FROM DC_RESERVE_MASTER C1
                                          LEFT OUTER JOIN DC_RENT_COMPANY_TIME C2
                                                          ON C1.RT_IDX = C2.RT_IDX
                             ) S3
                        WHERE  (S3.START_DT BETWEEN #{startTimestamp} AND #{endTimestamp})
                               OR (S3.END_DT BETWEEN #{startTimestamp} AND #{endTimestamp})
                               OR (S3.START_DT <= #{startTimestamp} AND S3.END_DT >= #{endTimestamp})
                                AND S3.CR_IDX = T1.CR_IDX)

                                AND (CASE WHEN #{longTermYn} = 'ST' THEN
                                 T1.DAILY_YN = 'Y'
                                        ELSE T1.MONTHLY_YN = 'Y' END)
                                GROUP BY CR_IDX
                                ORDER BY T1.DAILY_STANDARD_PAY, T1.DAILY_MAX_RATE DESC , T1.MONTHLY_STANDARD_PAY, T1.MONTHLY_MAX_RATE DESC




        ]]>
		
   </select>

    <!-- 검색 할 차량 옵션이 있을 경우 쿼리 -->
    <select id="selectTargetCarListSearchCarOption" parameterType="DochaMap" resultType="DochaCarInfoDto">
   		<![CDATA[

         SELECT
                        T1.*,
            IFNULL(T4.DELIVERY_ABLE, 0) AS DELIVERY_ABLE,
            IFNULL(T5.VISIT_ABLE, 0) AS VISIT_ABLE
                FROM (
                         SELECT A.CR_IDX                            AS CR_IDX
                              , A.MD_IDX                            AS MD_IDX
                              , A.RT_IDX                            AS RT_IDX
                              , IFNULL(A.MODEL_NAME, '')            AS MODEL_NAME
                              , IFNULL(A.MODEL_DETAIL_NAME, '')     AS MODEL_DETAIL_NAME
                              , IFNULL(A.FUEL_CODE, '')             AS FUEL_CODE
                              , IFNULL(A.TRANSMISSION_CODE, '')     AS TRANSMISSION_CODE
                              , IFNULL(A.DRIVE_TYPE_CODE, '')       AS DRIVE_TYPE_CODE
                              , IFNULL(A.CARTYPE_CODE, '')          AS CARTYPE_CODE
                              , IFNULL(A.DRIVE_LICENSE_CODE, '')    AS DRIVE_LICENSE_CODE
                              , IFNULL(A.MANUFACTURER_CODE, '')     AS MANUFACTURER_CODE
                              , IFNULL(A.COLOR_NAME, '')            AS COLOR_NAME
                              , IFNULL(A.DISPLACEMENT, '')          AS DISPLACEMENT
                              , IFNULL(A.YEAR, '')                  AS YEAR
                              , IFNULL(A.MILEAGE, '')               AS MILEAGE
                              , IFNULL(A.MAXIMUM_PASSENGER, '')     AS MAXIMUM_PASSENGER
                              , IFNULL(A.PY_IDX, '')                AS PY_IDX
                              , IFNULL(A.SHORTTERM_FEE, '')         AS SHORTTERM_FEE
                              , IFNULL(A.LONGTERM_FEE, '')          AS LONGTERM_FEE
                              , IFNULL(A.LONGTERM_DEPOSIT, '')      AS LONGTERM_DEPOSIT
                              , IFNULL(A.CAR_STATUS_CODE, '')       AS CAR_STATUS_CODE
                              , IFNULL(A.RESERVE_ABLE_YN, '')       AS RESERVE_ABLE_YN
                              , IFNULL(A.CAR_REG_DT, '')            AS CAR_REG_DT
                              , IFNULL(A.CAR_NUMBER, '')            AS CAR_NUMBER
                              , IFNULL(A.CAR_CHASSIS_NUMBER, '')    AS CAR_CHASSIS_NUMBER
                              , IFNULL(A.CAR_DRIVE_LIMIT, '')       AS CAR_DRIVE_LIMIT
                              , IFNULL(A.AGE_LIMIT, '')             AS AGE_LIMIT
                              , IFNULL(A.GARAGE_ADDR, '')           AS GARAGE_ADDR
                              , IFNULL(A.CAR_ETC, '')               AS CAR_ETC
                              , IFNULL(A.REG_ID, '')                AS REG_ID
                              , IFNULL(A.REG_DT, '')                AS REG_DT
                              , IFNULL(A.DEL_YN, '')                AS DEL_YN
                              , IFNULL(A.DAILY_YN, '')                AS DAILY_YN
                              , IFNULL(A.MONTHLY_YN, '')                AS MONTHLY_YN
                              , IFNULL(T3.DAILY_STANDARD_PAY, '')   AS DAILY_STANDARD_PAY
                              , IFNULL(T3.MONTHLY_STANDARD_PAY, '') AS MONTHLY_STANDARD_PAY
                              , IFNULL(T3.DAILY_MAX_RATE, '')             AS DAILY_MAX_RATE
                              , IFNULL(T3.MONTHLY_MAX_RATE, '')             AS MONTHLY_MAX_RATE
                              , IFNULL(A.CI_IDX, '')                AS CI_IDX
                              , IFNULL(A.IMG_IDX, '')               AS IMG_IDX
                              , IFNULL(A.PER_IDX, '')               AS PER_IDX
                              , IFNULL(T2.COMPANY_NAME, '')         AS COMPANY_NAME
                              , IFNULL(T2.COMPANY_ADDRESS, '')      AS COMPANY_ADDRESS
                              , IFNULL(T2.BRANCH_NAME, '')          AS BRANCH_NAME
                              , IFNULL(GROUP_CONCAT(T4.OPTION_DETAIL_CODE), '') AS OPTION_DETAIL_CODE
                         FROM DC_CAR_INFO A
                                  LEFT OUTER JOIN DC_RENT_COMPANY T2
                                                  ON A.RT_IDX = T2.RT_IDX

                                  LEFT OUTER JOIN DC_PAYMENT_INFO T3
                                                  ON A.CR_IDX = T3.CR_IDX

                                  LEFT OUTER JOIN DC_CAR_INFO_OPTION T4
                                                  ON A.CR_IDX = T4.CR_IDX

                         WHERE (A.DEL_YN NOT IN('Y') OR A.DEL_YN IS NULL)
                                              AND  (CASE WHEN #{longTermYn} = 'ST' THEN
                                                        T3.DAILY_STANDARD_PAY IS NOT NULL
                                                        AND  T3.DAILY_STANDARD_PAY != '0'
                                                        AND  T3.DAILY_STANDARD_PAY != ''

                                                ELSE T3.MONTHLY_STANDARD_PAY IS NOT NULL
                                                AND T3.MONTHLY_STANDARD_PAY != '0'
                                                AND T3.MONTHLY_STANDARD_PAY != '' END)
                                              AND  INSTR(#{carTypeCodeList} , A.CARTYPE_CODE) > 0
                                              AND  INSTR(#{manufacturerCodeList} , A.MANUFACTURER_CODE) > 0
                                              AND  INSTR(#{yearList} , A.YEAR) > 0
                                              AND  (
                                              T2.COMPANY_ADDRESS LIKE   '%' #{addr1} '%'
                                                                    OR     T2.COMPANY_ADDRESS LIKE  '%'  #{addr2} '%'
                                                                    OR     T2.COMPANY_ADDRESS LIKE  '%'  #{addr3} '%' )
                           GROUP BY CR_IDX
                     ) T1
                         INNER JOIN (
                    SELECT B1.RT_IDX
                    FROM DC_RENT_COMPANY B1
                             INNER JOIN
                         DC_RENT_COMPANY_TIME B2
                         ON B1.RT_IDX = B2.RT_IDX
                      AND NOT EXISTS(
                            SELECT *
                            FROM (
                                     SELECT RT_IDX
                                     FROM DC_RENT_COMPANY_RESERVE_MIN
                                     WHERE ((MINIMUM_START_DT <= #{startDate}
                                         AND MINIMUM_END_DT >= #{startDate})
                                         OR (MINIMUM_START_DT <= #{endDate}
                                             AND MINIMUM_END_DT >= #{endDate}))
                                       AND #{calHour} < MINIMUM_TIME
                                 ) S2
                            WHERE B1.RT_IDX = S2.RT_IDX
                        )

                      AND NOT EXISTS(
                            SELECT *
                            FROM (
                                     SELECT RT_IDX
                                     FROM DC_HOLIDAYS
                                     WHERE ((HOLIDAY_START_DT <= #{startDate}
                                         AND HOLIDAY_END_DT >= #{startDate})
                                         OR (HOLIDAY_START_DT <= #{endDate}
                                             AND HOLIDAY_END_DT >= #{endDate}))
                                       AND CR_IDX IS NULL
                                     GROUP BY RT_IDX
                                 ) S3
                            WHERE B1.RT_IDX = S3.RT_IDX
                        )
                      AND NOT EXISTS(
                            SELECT *
                            FROM (
                                     SELECT RT_IDX
                                     FROM DC_HOLIDAYS
                                     WHERE ((HOLIDAY_START_DT <= #{startDate}
                                         AND HOLIDAY_END_DT >= #{startDate})
                                         OR (HOLIDAY_START_DT <= #{endDate}
                                             AND HOLIDAY_END_DT >= #{endDate}))
                                       AND RT_IDX = 'all'
                                     GROUP BY RT_IDX
                                 ) S4
                            WHERE S4.RT_IDX = 'all'
                        )
                ) T3  ON T1.RT_IDX = T3.RT_IDX

                INNER JOIN (
                     SELECT CR_IDX
                FROM (SELECT CR_IDX, GROUP_CONCAT(OPTION_DETAIL_CODE SEPARATOR ',') AS OPTION_NAME
                      FROM DC_CAR_INFO_OPTION
                      GROUP BY CR_IDX) AS OPTION_TABLE
                WHERE OPTION_NAME LIKE #{carOptionCodeList}
            ) T2 ON T1.CR_IDX = T2.CR_IDX

                LEFT OUTER JOIN (SELECT B1.RT_IDX, 1 AS DELIVERY_ABLE
                    FROM DC_RENT_COMPANY B1
                        INNER JOIN
                         DC_RENT_COMPANY_TIME B2
                         ON B1.RT_IDX = B2.RT_IDX
                         LEFT OUTER JOIN DC_RENT_COMPANY_ABLEAREA B3
                         ON B1.RT_IDX = B3.RT_IDX

                    WHERE (
                                      (CASE
                                           WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKEND_DELIVERY_START
                                           ELSE B2.WEEKDAY_DELIVERY_START END) <= #{startTime} AND
                                      (CASE
                                           WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKDAY_DELIVERY_END
                                           ELSE B2.WEEKEND_DELIVERY_END END) >= #{startTime} AND
                                      (CASE
                                           WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKEND_DELIVERY_START
                                           ELSE B2.WEEKDAY_DELIVERY_START END) <= #{endTime}
                                  AND (CASE
                                           WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKDAY_DELIVERY_END
                                           ELSE B2.WEEKEND_DELIVERY_END END) >= #{endTime})
                                AND ( CASE WHEN #{longTermYn} = 'ST' THEN

                            (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND (B3.ADDR_DEPTH2 LIKE    '' OR B3.ADDR_DEPTH2 LIKE '전체')
                                    AND B3.ADDR_DEPTH3 LIKE   ''  AND B3.ADDR_DEPTH4 LIKE    '' AND B3.RA_GBN_CODE = 'S'   )

                                 OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND (B3.ADDR_DEPTH3 LIKE '' OR B3.ADDR_DEPTH3 LIKE '전체')  AND B3.ADDR_DEPTH4 LIKE    '' AND B3.RA_GBN_CODE = 'S'   )

                            OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND B3.ADDR_DEPTH3 LIKE  '%' #{addr3} '%'  AND (B3.ADDR_DEPTH4 LIKE '' OR B3.ADDR_DEPTH4 LIKE '전체')  AND B3.RA_GBN_CODE = 'S'  )

                            OR     (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE   '%' #{addr2} '%'
                                AND B3.ADDR_DEPTH3 LIKE   '%' #{addr3} '%' AND B3.ADDR_DEPTH4 LIKE   '%' #{addr4} '%' AND B3.RA_GBN_CODE = 'S'    )


                                ELSE
                                 (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND (B3.ADDR_DEPTH2 LIKE  '' OR B3.ADDR_DEPTH2 LIKE '전체')
                                    AND B3.ADDR_DEPTH3 LIKE   ''  AND B3.ADDR_DEPTH4 LIKE    '' AND B3.RA_GBN_CODE = 'L'    )

                                 OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND (B3.ADDR_DEPTH3 LIKE '' OR B3.ADDR_DEPTH3 LIKE '전체')  AND B3.ADDR_DEPTH4 LIKE    ''  AND B3.RA_GBN_CODE = 'L'  )

                            OR (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE    '%' #{addr2} '%'
                                    AND B3.ADDR_DEPTH3 LIKE  '%' #{addr3} '%'  AND (B3.ADDR_DEPTH4 LIKE '' OR B3.ADDR_DEPTH4 LIKE '전체')  AND B3.RA_GBN_CODE = 'L'  )

                            OR     (B3.ADDR_DEPTH1 LIKE   '%' #{delAddr1} '%' AND B3.ADDR_DEPTH2 LIKE   '%' #{addr2} '%'
                                AND B3.ADDR_DEPTH3 LIKE   '%' #{addr3} '%' AND B3.ADDR_DEPTH4 LIKE   '%' #{addr4} '%' AND B3.RA_GBN_CODE = 'L'   )
                                 END
                )

                ) T4 ON T1.RT_IDX = T4.RT_IDX

                LEFT OUTER JOIN (
                    SELECT B1.RT_IDX, 1 AS VISIT_ABLE
                    FROM DC_RENT_COMPANY B1
                             INNER JOIN
                         DC_RENT_COMPANY_TIME B2
                         ON B1.RT_IDX = B2.RT_IDX
                    WHERE (
                                      (CASE
                                           WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKEND_OPEN_START
                                           ELSE B2.WEEKDAY_OPEN_START END) <= #{startTime} AND
                                      (CASE WHEN DAYOFWEEK(#{startDate}) = 1 OR 7 THEN B2.WEEKDAY_OPEN_END ELSE B2.WEEKEND_OPEN_END END) >=
                                      #{startTime} AND
                                      (CASE
                                           WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKEND_OPEN_START
                                           ELSE B2.WEEKDAY_OPEN_START END) <= #{endTime}
                                  AND (CASE WHEN DAYOFWEEK(#{endDate}) = 1 OR 7 THEN B2.WEEKDAY_OPEN_END ELSE B2.WEEKEND_OPEN_END END) >=
                                      #{endTime})
                ) T5 ON T1.RT_IDX = T5.RT_IDX

                WHERE (DELIVERY_ABLE = 1 OR VISIT_ABLE = 1) AND  T1.CR_IDX NOT IN (SELECT *
                        FROM (
                                 SELECT CR_IDX
                                 FROM DC_HOLIDAYS
                                 WHERE ((HOLIDAY_START_DT <= #{startDate}
                                     AND HOLIDAY_END_DT >= #{startDate})
                                     OR (HOLIDAY_START_DT <= #{endDate}
                                         AND HOLIDAY_END_DT >= #{endDate}))
                                 GROUP BY CR_IDX
                             ) S1
                        WHERE S1.CR_IDX = T1.CR_IDX
                    )

                  AND T1.CR_IDX NOT IN (
                        SELECT CR_IDX
                        FROM (
                                 SELECT C1.CR_IDX
                                      , DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_START_DAY, ' ', RENT_START_TIME), '%Y-%m-%d %H:%i'),
                                                    '%Y-%m-%d %H:%i') AS START_DT
                                      , CASE
                                            WHEN C1.DELIVERY_TYPE_CODE = 'OF'
                                                THEN ADDTIME(
                                                    DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_END_DAY, ' ', RENT_END_TIME), '%Y-%m-%d %H:%i'),
                                                                '%Y-%m-%d %H:%i'), STR_TO_DATE(C2.RETURN_INSPECTION_TIME, '%H'))
                                            ELSE
                                                CASE
                                                    WHEN DAYOFWEEK(C1.RENT_END_DAY) = 1 OR 7
                                                        THEN ADDTIME(DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_END_DAY, ' ', RENT_END_TIME),
                                                                                             '%Y-%m-%d %H:%i'), '%Y-%m-%d %H:%i'),
                                                                     STR_TO_DATE(C2.WEEKEND_ABLE_DELIVERY_TIME, '%H'))
                                                    ELSE ADDTIME(DATE_FORMAT(STR_TO_DATE(CONCAT(RENT_END_DAY, ' ', RENT_END_TIME),
                                                                                         '%Y-%m-%d %H:%i'), '%Y-%m-%d %H:%i'),
                                                                 STR_TO_DATE(C2.WEEKDAY_ABLE_DELIVERY_TIME, '%H')) END
                                     END                              AS END_DT

                                 FROM DC_RESERVE_MASTER C1
                                          LEFT OUTER JOIN DC_RENT_COMPANY_TIME C2
                                                          ON C1.RT_IDX = C2.RT_IDX
                             ) S3
                        WHERE  (S3.START_DT BETWEEN #{startTimestamp} AND #{endTimestamp})
                               OR (S3.END_DT BETWEEN #{startTimestamp} AND #{endTimestamp})
                               OR (S3.START_DT <= #{startTimestamp} AND S3.END_DT >= #{endTimestamp})
                                AND S3.CR_IDX = T1.CR_IDX)
                                AND (CASE WHEN #{longTermYn} = 'ST' THEN
                                 T1.DAILY_YN = 'Y'
                                        ELSE T1.MONTHLY_YN = 'Y' END)
                                GROUP BY CR_IDX
                                ORDER BY T1.DAILY_STANDARD_PAY, T1.DAILY_MAX_RATE DESC , T1.MONTHLY_STANDARD_PAY, T1.MONTHLY_MAX_RATE DESC



        ]]>

   </select>


    <select id="selectTargetCarForExtension" parameterType="DochaMap" resultType="DochaCarInfoDto">
        <![CDATA[






                                                       SELECT T1.CR_IDX 								AS CR_IDX
                                                                  ,      T1.MD_IDX								AS MD_IDX
                                                                  ,      T1.RT_IDX								AS RT_IDX
                                                                  ,      IFNULL(T1.MODEL_NAME                 , '' ) AS MODEL_NAME
                                                                  ,      IFNULL(T1.MODEL_DETAIL_NAME          , '' ) AS MODEL_DETAIL_NAME
                                                                  ,      IFNULL(T1.FUEL_CODE          		 , '' ) AS FUEL_CODE
                                                                  ,      IFNULL(T1.TRANSMISSION_CODE          , '' ) AS TRANSMISSION_CODE
                                                                  ,      IFNULL(T1.DRIVE_TYPE_CODE            , '' ) AS DRIVE_TYPE_CODE
                                                                  ,      IFNULL(T1.CARTYPE_CODE               , '' ) AS CARTYPE_CODE
                                                                  ,      IFNULL(T1.DRIVE_LICENSE_CODE         , '' ) AS DRIVE_LICENSE_CODE
                                                                  ,      IFNULL(T1.MANUFACTURER_CODE          , '' ) AS MANUFACTURER_CODE
                                                                  ,      IFNULL(T1.COLOR_NAME                 , '' ) AS COLOR_NAME
                                                                  ,      IFNULL(T1.DISPLACEMENT               , '' ) AS DISPLACEMENT
                                                                  ,      IFNULL(T1.YEAR                       , '' ) AS YEAR
                                                                  ,      IFNULL(T1.MILEAGE                    , '' ) AS MILEAGE
                                                                  ,      IFNULL(T1.MAXIMUM_PASSENGER          , '' ) AS MAXIMUM_PASSENGER
                                                                  ,      IFNULL(T1.PY_IDX                     , '' ) AS PY_IDX
                                                                  ,      IFNULL(T1.SHORTTERM_FEE              , '' ) AS SHORTTERM_FEE
                                                                  ,      IFNULL(T1.LONGTERM_FEE               , '' ) AS LONGTERM_FEE
                                                                  ,      IFNULL(T1.LONGTERM_DEPOSIT           , '' ) AS LONGTERM_DEPOSIT
                                                                  ,      IFNULL(T1.CAR_STATUS_CODE            , '' ) AS CAR_STATUS_CODE
                                                                  ,      IFNULL(T1.RESERVE_ABLE_YN            , '' ) AS RESERVE_ABLE_YN
                                                                  ,      IFNULL(T1.CAR_REG_DT                 , '' ) AS CAR_REG_DT
                                                                  ,      IFNULL(T1.CAR_NUMBER                 , '' ) AS CAR_NUMBER
                                                                  ,      IFNULL(T1.CAR_CHASSIS_NUMBER         , '' ) AS CAR_CHASSIS_NUMBER
                                                                  ,      IFNULL(T1.CAR_DRIVE_LIMIT            , '' ) AS CAR_DRIVE_LIMIT
                                                                  ,      IFNULL(T1.AGE_LIMIT                  , '' ) AS AGE_LIMIT
                                                                  ,      IFNULL(T1.GARAGE_ADDR                , '' ) AS GARAGE_ADDR
                                                                  ,      IFNULL(T1.CAR_ETC                    , '' ) AS CAR_ETC
                                                                  ,      IFNULL(T1.REG_ID                     , '' ) AS REG_ID
                                                                  ,      IFNULL(T1.REG_DT                     , '' ) AS REG_DT
                                                                  ,      IFNULL(T1.DEL_YN                     , '' ) AS DEL_YN
                                                                  ,      IFNULL(T3.DAILY_STANDARD_PAY         , '' ) AS DAILY_STANDARD_PAY
                                                                  ,      IFNULL(T3.MONTHLY_STANDARD_PAY       , '' ) AS MONTHLY_STANDARD_PAY
                                                                  ,      IFNULL(T1.CI_IDX                     , '' ) AS CI_IDX
                                                                  ,      IFNULL(T1.IMG_IDX                     , '' ) AS IMG_IDX
                                                                  ,      IFNULL(T1.PER_IDX                    , '' ) AS PER_IDX
                                                                  ,      IFNULL(T2.COMPANY_NAME               , '' ) AS COMPANY_NAME
                                                                  ,      IFNULL(T2.COMPANY_ADDRESS            , '' ) AS COMPANY_ADDRESS
                                                                  ,      IFNULL(T2.BRANCH_NAME				 , '' ) AS BRANCH_NAME

                                                      FROM   DC_CAR_INFO T1
                                                      LEFT OUTER JOIN DC_RENT_COMPANY T2
                                                      ON T1.RT_IDX = T2.RT_IDX

                                                      LEFT OUTER JOIN DC_PAYMENT_INFO T3
                                                      ON T1.CR_IDX = T3.CR_IDX

                                                      WHERE (T1.DEL_YN NOT IN('Y') OR T1.DEL_YN IS NULL)
                                                      AND  (T1.RESERVE_ABLE_YN IS NULL OR T1.RESERVE_ABLE_YN = 'Y')
                                                      AND  T3.DAILY_STANDARD_PAY IS NOT NULL
                                                      AND  T3.DAILY_STANDARD_PAY != '0'
                                                      AND  T3.DAILY_STANDARD_PAY != ''
                                                      AND  T3.MONTHLY_STANDARD_PAY IS NOT NULL
                                                      AND  T3.MONTHLY_STANDARD_PAY != '0'
                                                      AND  T3.MONTHLY_STANDARD_PAY != ''
                                                      AND T1.CR_IDX = #{crIdx}





        ]]>

    </select>


    <select id="selectPaymentSuccessDetail" parameterType="DochaMap" resultType="DochaPaymentResultDto">
        <![CDATA[
				SELECT  
					T1.RM_IDX		
				,	IFNULL(T1.RESERVE_STATUS_CODE           , '' ) AS QUOTE_CODE     /* 견적구분코드		*/
				,	IFNULL(T1.RESERVE_STATUS_CODE         , '' ) AS QUOTE_STATUS     /* 견적상태			*/
				,	IFNULL(T1.LONGTERM_YN          , '' ) AS LONGTERM_YN             /* 장단기구분		*/
				,	IFNULL(T1.CARTYPE_CODE	   		, '' ) AS CARTYPE_CODE       	  /* 검색 LIST		*/
				,	IFNULL(T1.CR_IDX               , '' ) AS CR_IDX                  /* CAR IDX   		*/
				,	IFNULL(T1.CARTYPE_CODE         , '' ) AS CARTYPE_CODE            /* CAR TYPE		*/
				,	IFNULL(T1.RENT_START_DAY       , '' ) AS RENT_START_DAY          /* 대여시작일		*/
				,	IFNULL(T1.RENT_END_DAY         , '' ) AS RENT_END_DAY            /* 대여종료일		*/
				,	IFNULL(T1.RENT_START_TIME      , '' ) AS RENT_START_TIME         /* 대여시작시간		*/
				,	IFNULL(T1.RENT_END_TIME        , '' ) AS RENT_END_TIME           /* 대여종료시간		*/
				,	IFNULL(T1.RENT_FEE             , '0' ) AS RENT_FEE				  /* 대여료			*/
	      		,	IFNULL(T1.INSURANCE_FEE       , '0' )  AS INSURANCE_FEE		  /* 보험료			*/
				,	IFNULL(T1.DELIVERY_TYPE_CODE   , '' ) AS DELIVERY_TYPE_CODE      /* 배차방법			*/
				,	IFNULL(T1.DELIVERY_ADDR        , '' ) AS DELIVERY_ADDR           /* 배차주소			*/
				,	IFNULL(T1.RETURN_TYPE_CODE     , '' ) AS RETURN_TYPE_CODE        /* 반차방법			*/
				,	IFNULL(T1.RETURN_ADDR          , '' ) AS RETURN_ADDR             /* 반차주소			*/
				,	IFNULL(T1.RT_IDX               , '' ) AS RT_IDX                  /* 제휴사 IDX		*/
				,	IFNULL(T1.FIRST_DRIVER_NAME    , '' ) AS FIRST_DRIVER_NAME       /* 운전자1 이름		*/
				,	IFNULL(T1.UL_IDX1              , '' ) AS UL_IDX1                 /* 운전자1 IDX		*/
-- 				,	IFNULL(T1.SECOND_DRIVER_NAME   , '' ) AS SECOND_DRIVER_NAME      /* 운전자2 이름		*/
				,	IFNULL(T1.UL_IDX2              , '' ) AS UL_IDX2                 /* 운전자2 IDX		*/
				,	IFNULL(T1.UR_IDX               , '' ) AS UR_IDX                  /* 유저 IDX			*/
				,	IFNULL(T1.REG_ID               , '' ) AS REG_ID                  /* 등록자아이디		*/
				,	IFNULL(DATE_FORMAT(T1.REG_DT , 'YYYYMMDD')  	, ' ' ) AS REG_DT     /* 등록일시             	*/
				,	IFNULL(T1.MOD_ID               , '' ) AS MOD_ID                  /* 수정자아이디		*/
				,	IFNULL(T1.MOD_DT               , '' ) AS MOD_DT                  /* 수정일			*/
				,	IFNULL(T1.DEL_YN               , '' ) AS DEL_YN                  /* 삭제여부 			*/
	            ,	IFNULL(T7.CAR_DAMAGE_COVER     , '0' ) AS CAR_DAMAGE_COVER       /* 자차보상금액*/
	            ,	IFNULL(T7.ONSELF_DAMAGE_COVER  , '0' ) AS ONSELF_DAMAGE_COVER    /* 자손보상금액*/
	            ,	IFNULL(T7.PERSONAL_COVER       , '0' ) AS PERSONAL_COVER         /* 대인보상금액*/
	            ,	IFNULL(T7.PROPERTY_DAMAGE_COVER, '0' ) AS PROPERTY_DAMAGE_COVER  /* 대물보상금액*/
	            ,	IFNULL(T7.DRIVE_CAREER_LIMIT   , '' ) AS DRIVE_CAREER_LIMIT      /* 운전경력제한*/
	            ,	IFNULL(T7.INSURANCE_COPAYMENT  , '0' ) AS INSURANCE_COPAYMENT    /* 본인부담금  */
	            ,   IFNULL(T4.APPROVAL_NUMBER  , '' ) AS APPROVAL_NUMBER     		  /* 승인번호  */ -- 1건일경우 문제없으나 n건일경우 문제로 JOIN절 서브쿼리
				,	IFNULL(T5.USER_ID              , '' ) AS USER_ID                 /*  아이디			*/
				,	IFNULL(T5.USER_NAME            , '' ) AS USER_NAME               /*  이름				*/
				,	IFNULL(T5.USER_BIRTHDAY        , '' ) AS USER_BIRTHDAY           /*  생년월일			*/
				,	IFNULL(T5.USER_GENDER          , '' ) AS USER_GENDER          	  /*  성별				*/
				,	IFNULL(T5.USER_CONTACT1        , '' ) AS USER_CONTACT1			  /* 연락처 1			*/
				,	IFNULL(T5.USER_CONTACT2        , '' ) AS USER_CONTACT2   	 	  /* 연락처 2			*/
				,	IFNULL(T6.MD_IDX               , '' ) AS MD_IDX                  /* 모델상세idx 		*/
			    ,	IFNULL(T6.MODEL_NAME           , '' ) AS MODEL_NAME              /* 모델명      			*/
			    ,	IFNULL(T6.MODEL_DETAIL_NAME    , '' ) AS MODEL_DETAIL_NAME       /* 모델상세명 			*/
			    ,	IFNULL(T6.FUEL_CODE            , '' ) AS FUEL_CODE               /* 연료구분 			*/
			    ,	IFNULL(T6.TRANSMISSION_CODE    , '' ) AS TRANSMISSION_CODE       /* 변속기구분code 	*/
			    ,	IFNULL(T6.DRIVE_TYPE_CODE      , '' ) AS DRIVE_TYPE_CODE         /* 구동방식구분code   	*/
			    ,	IFNULL(T6.CARTYPE_CODE         , '' ) AS CARTYPE_CODE            /* 차종code      	*/
			    ,	IFNULL(GET_COMMON_CODE_VALUE('CR',T6.DRIVE_LICENSE_CODE) , '' ) AS DRIVE_LICENSE_CODE      /* 면허구분code   	*/
			    ,	IFNULL(T6.MANUFACTURER_CODE    , '' ) AS MANUFACTURER_CODE       /* 제조사code    	*/
			    ,	IFNULL(T6.COLOR_NAME           , '' ) AS COLOR_NAME              /* 색상code    		*/
			    ,	IFNULL(GET_COMMON_CODE_VALUE('CR',T6.FUEL_CODE) , '' )  AS FUEL_NAME   /* 연료구분명         	*/
		    	,	IFNULL(T6.DISPLACEMENT         , '' ) AS DISPLACEMENT            /* 배기량          		*/
			    ,	IFNULL(T6.YEAR                 , '' ) AS YEAR                    /* 연식           		*/
			    ,	IFNULL(T6.MILEAGE              , '' ) AS MILEAGE                 /* 주행거리     		*/
			    ,	IFNULL(T6.MAXIMUM_PASSENGER    , '' ) AS MAXIMUM_PASSENGER       /* 승차인원     		*/
			    ,	IFNULL(T6.PY_IDX               , '' ) AS PY_IDX                  /* 요금idx    		*/
			    ,	IFNULL(T6.DAILY_STANDARD_PAY        , '0' ) AS DAILY_STANDARD_PAY           /* 단기요금      		*/
			    ,	IFNULL(T6.DAILY_STANDARD_PAY         , '0' ) AS DAILY_STANDARD_PAY            /* 장기요금     		*/
			    ,	IFNULL(T6.MONTHLY_STANDARD_PAY     , '0' ) AS MONTHLY_STANDARD_PAY        /* 장기대여보증금   		*/
			    ,	IFNULL(T6.CAR_STATUS_CODE      , '' ) AS CAR_STATUS_CODE         /* 차량상태code 		*/
			    ,	IFNULL(T6.RESERVE_ABLE_YN      , '' ) AS RESERVE_ABLE_YN         /* 차량예약가능여부code */
			    ,	IFNULL(T6.CAR_REG_DT           , '' ) AS CAR_REG_DT              /* 차량등록일  		*/
			    ,	IFNULL(T6.CAR_NUMBER           , '' ) AS CAR_NUMBER              /* 차량번호   			*/
			    ,	IFNULL(T6.CAR_CHASSIS_NUMBER   , '' ) AS CAR_CHASSIS_NUMBER      /* 차대번호  			*/
			    --,	IFNULL(T6.IMG_IDX              , '' ) AS IMG_IDX                 /* 이미지idx   		*/
			    ,	IFNULL(T6.CAR_DRIVE_LIMIT      , '' ) AS CAR_DRIVE_LIMIT         /* 주행거리제한  		*/
			    ,	IFNULL(T6.AGE_LIMIT            , '' ) AS AGE_LIMIT               /* 대여연령제한   		*/
			    ,	IFNULL(T6.GARAGE_ADDR          , '' ) AS GARAGE_ADDR             /* 차고지주소    		*/
			    ,	IFNULL(T6.CAR_ETC              , '' ) AS CAR_ETC                 /* 비고      			*/
			    ,	IFNULL(GET_COMMON_CODE_VALUE('CR',T6.MANUFACTURER_CODE) , '' )  AS MANUFACTURER_NAME   /* 제조사명         	*/
			    ,	IFNULL(T7.CAR_DAMAGE_COVER     , '0' ) AS CAR_DAMAGE_COVER        				/* 자차보상금액*/
	            ,	IFNULL(T7.ONSELF_DAMAGE_COVER  , '0' ) AS ONSELF_DAMAGE_COVER     				/* 자손보상금액*/
	            ,	IFNULL(T7.PERSONAL_COVER       , '0' ) AS PERSONAL_COVER          				/* 대인보상금액*/
	            ,	IFNULL(T7.PROPERTY_DAMAGE_COVER, '0' ) AS PROPERTY_DAMAGE_COVER   				/* 대물보상금액*/
	            ,	IFNULL(T7.DRIVE_CAREER_LIMIT   , '' ) AS DRIVE_CAREER_LIMIT      				/* 운전경력제한*/
	            ,	IFNULL(T7.INSURANCE_COPAYMENT  , '0' ) AS INSURANCE_COPAYMENT     				/* 본인부담금  */
				,	IFNULL(T8.COMPANY_NAME         , '' ) AS COMPANY_NAME            				/* 제휴사명    */
	            ,	IFNULL(T8.COMPANY_NAME   , '' ) AS COMPANY_NAME      							/* 회원사 이름 */
				,	IFNULL(T8.COMPANY_ADDRESS   , '' ) AS COMPANY_ADDRESS      					/* 회원사 주소 */
				,	IFNULL(T8.COMPANY_CONTACT1    , '' ) AS COMPANY_CONTACT1 						/*회사대표번호 */
				,	IFNULL(T8.COMPANY_CONTACT2    , '' ) AS COMPANY_CONTACT2 						/*회사대표번호 */
				,	IFNULL(DATE_FORMAT(T1.REG_DT , 'YYYY-MM-DD HH:MM')  	, ' ' ) AS RESERVE_DATE     /* 예약일시    */
				,	IFNULL(T1.CAR_DEPOSIT    , '' ) AS CAR_DEPOSIT 								/* 보증금 	   */
				FROM DC_RESERVE_MASTER T1
                LEFT OUTER JOIN DC_RESERVE_LOG T2
                    ON T1.RM_IDX = T2.RM_IDX
                LEFT OUTER JOIN     
					 (
						SELECT * FROM (	
							SELECT 
								* 
							FROM DC_PAYMENT_DETAIL
							WHERE RM_IDX = #{rmIdx}
							ORDER BY PAYMENT_DATE DESC
						) WHERE ROWNUM = 1 
					 ) T4
                    ON T1.RM_IDX = T4.RM_IDX 
				LEFT OUTER JOIN DC_USER_INFO T5
                    ON T1.UR_IDX = T5.UR_IDX 
				LEFT OUTER JOIN DC_CAR_INFO T6
                    ON T1.CR_IDX = T6.CR_IDX
				LEFT OUTER JOIN DC_CAR_INFO_INSURANCE T7
                    ON T1.CR_IDX = T7.CR_IDX
				LEFT OUTER JOIN DC_RENT_COMPANY T8
                    ON T1.RT_IDX = T8.RT_IDX             
                  
	        ]]>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="rmIdx != null and rmIdx != '' ">
                AND T1.RM_IDX = #{rmIdx}
            </if>
            <if test="quoteStatus != null and quoteStatus != '' ">
                AND T1.RESERVE_STATUS_CODE = #{quoteStatus}
            </if>
        </trim>
    </select>


    <update id="updateDcCarInfo" parameterType="DochaMap">
	
		UPDATE DC_CAR_INFO
		SET    RESERVE_ABLE_YN = #{reserveAbleYn},
		       CAR_STATUS_CODE = #{carStatusCode}
		WHERE  CR_IDX = #{crIdx}
	</update>

    <select id="getRentFee" parameterType="list" resultType="DochaCalcRentFeeDto">
        SELECT CR_IDX
        , CAR_NUMBER
        , RENT_FEE
        , DIS_RENT_FEE
        , INSURANCE_FEE
        , INSURANCE_FEE2
        , INSURANCE_FEE3
        , INSURANCE_FEE4
        , MM_RENT_FEE
        , MM_LAST_RENT_FEE
        <foreach collection="list" index="index" item="item">
            <choose>
                <when test="index == 0 ">
                    FROM TABLE( FN_RESERVE_AMT(#{item.rentStartDt},#{item.rentEndDt},#{item.crIdx}) )
                </when>
                <otherwise>
                    UNION ALL
                    SELECT CR_IDX
                    , CAR_NUMBER
                    , RENT_FEE
                    , DIS_RENT_FEE
                    , INSURANCE_FEE
                    , INSURANCE_FEE2
                    , INSURANCE_FEE3
                    , INSURANCE_FEE4
                    , MM_RENT_FEE
                    , MM_LAST_RENT_FEE
                    FROM TABLE( FN_RESERVE_AMT(#{item.rentStartDt},#{item.rentEndDt},#{item.crIdx}) )
                </otherwise>
            </choose>

        </foreach>

    </select>

    <!-- 
    	결제페이지 차량정보 처리를 위한 쿼리, selectTargetCarList 쿼리의 JOIN과 동일해야 함(해당쿼리 수정시 하단의 쿼리도 수정필요)
      -->
    <select id="selectTargetCar" parameterType="DochaMap" resultType="DochaCarInfoDto">
   		<![CDATA[

                                   SELECT T1.CR_IDX								AS CR_IDX
                 ,      T1.MD_IDX								AS MD_IDX
                 ,      T1.RT_IDX								AS RT_IDX
                 ,      IFNULL(T1.MODEL_NAME                 , '' ) AS MODEL_NAME
                 ,      IFNULL(T1.MODEL_DETAIL_NAME          , '' ) AS MODEL_DETAIL_NAME
                 ,      IFNULL(T1.FUEL_CODE          		 , '' ) AS FUEL_CODE
                 ,      IFNULL(T1.TRANSMISSION_CODE          , '' ) AS TRANSMISSION_CODE
                 ,      IFNULL(T1.DRIVE_TYPE_CODE            , '' ) AS DRIVE_TYPE_CODE
                 ,      IFNULL(T1.CARTYPE_CODE               , '' ) AS CARTYPE_CODE
                 ,      IFNULL(T1.DRIVE_LICENSE_CODE         , '' ) AS DRIVE_LICENSE_CODE
                 ,      IFNULL(T1.MANUFACTURER_CODE          , '' ) AS MANUFACTURER_CODE
                 ,      IFNULL(T1.COLOR_NAME                 , '' ) AS COLOR_NAME
                 ,      IFNULL(T1.DISPLACEMENT               , '' ) AS DISPLACEMENT
                 ,      IFNULL(T1.YEAR                       , '' ) AS YEAR
                 ,      IFNULL(T1.MILEAGE                    , '' ) AS MILEAGE
                 ,      IFNULL(T1.MAXIMUM_PASSENGER          , '' ) AS MAXIMUM_PASSENGER
                 ,      IFNULL(T1.PY_IDX                     , '' ) AS PY_IDX
                 ,      IFNULL(T1.SHORTTERM_FEE              , '' ) AS SHORTTERM_FEE
                 ,      IFNULL(T1.LONGTERM_FEE               , '' ) AS LONGTERM_FEE
                 ,      IFNULL(T1.LONGTERM_DEPOSIT           , '' ) AS LONGTERM_DEPOSIT
                 ,      IFNULL(T1.CAR_STATUS_CODE            , '' ) AS CAR_STATUS_CODE
                 ,      IFNULL(T1.CAR_REG_DT                 , '' ) AS CAR_REG_DT
                 ,      IFNULL(T1.CAR_NUMBER                 , '' ) AS CAR_NUMBER
                 ,      IFNULL(T1.CAR_CHASSIS_NUMBER         , '' ) AS CAR_CHASSIS_NUMBER
                 ,      IFNULL(T1.CAR_DRIVE_LIMIT            , '' ) AS CAR_DRIVE_LIMIT
                 ,      IFNULL(T1.AGE_LIMIT                  , '' ) AS AGE_LIMIT
                 ,      IFNULL(T1.GARAGE_ADDR                , '' ) AS GARAGE_ADDR
                 ,      IFNULL(T1.CAR_ETC                    , '' ) AS CAR_ETC
                 ,      IFNULL(T1.RESERVE_ABLE_YN                    , '' ) AS RESERVE_ABLE_YN
                 ,      IFNULL(T1.REG_ID                     , '' ) AS REG_ID
                 ,      IFNULL(T1.REG_DT                     , '' ) AS REG_DT
                 ,      IFNULL(T1.DEL_YN                     , '' ) AS DEL_YN
                 ,      IFNULL(T3.DAILY_STANDARD_PAY         , '' ) AS DAILY_STANDARD_PAY
                 ,      IFNULL(T3.MONTHLY_STANDARD_PAY       , '' ) AS MONTHLY_STANDARD_PAY
                 ,      IFNULL(T1.CI_IDX                     , '' ) AS CI_IDX
                 ,      IFNULL(T1.IMG_IDX                     , '' ) AS IMG_IDX
                 ,      IFNULL(T1.PER_IDX                    , '' ) AS PER_IDX
                 ,      IFNULL(T2.COMPANY_NAME               , '' ) AS COMPANY_NAME
                 ,      IFNULL(T2.COMPANY_ADDRESS            , '' ) AS COMPANY_ADDRESS
                 ,      IFNULL(T2.COMPANY_CONTACT1            , '' ) AS COMPANY_CONTACT1
                 ,      IFNULL(T2.BRANCH_NAME				 , '' ) AS BRANCH_NAME

             FROM   DC_CAR_INFO T1
             LEFT OUTER JOIN DC_RENT_COMPANY T2
             ON T1.RT_IDX = T2.RT_IDX

             LEFT OUTER JOIN DC_PAYMENT_INFO T3
             ON T1.CR_IDX = T3.CR_IDX

             WHERE T1.CR_IDX = #{crIdx}
        ]]>
		
   </select>


    <select id="selectTargetCarPayment" parameterType="String" resultType="DochaCarSearchPaymentDetailDto">
   		<![CDATA[
                SELECT
                          IFNULL(T1.CR_IDX                 , '' ) AS CR_IDX
                   ,      IFNULL(T2.DAILY_STANDARD_PAY                 , '' ) AS DAILY_STANDARD_PAY
                   ,      IFNULL(T2.MONTHLY_STANDARD_PAY                 , '' ) AS MONTHLY_STANDARD_PAY
                   ,      IFNULL(T3.INSURANCE_COPAYMENT                 , '' ) AS INSURANCE_COPAYMENT
                   ,      IFNULL(T3.INSURANCE_COPAYMENT2          , '' ) AS INSURANCE_COPAYMENT2
                   ,      IFNULL(T3.INSURANCE_COPAYMENT3          , '' ) AS INSURANCE_COPAYMENT3
                   ,      IFNULL(T3.INSURANCE_COPAYMENT4          , '' ) AS INSURANCE_COPAYMENT4

                 FROM   DC_CAR_INFO T1

                 LEFT OUTER JOIN DC_PAYMENT_INFO T2
                 ON T1.CR_IDX = T2.CR_IDX

                 LEFT OUTER JOIN DC_CAR_INFO_INSURANCE T3
                 ON T1.CR_IDX = T3.CR_IDX

                 WHERE T1.CR_IDX = #{crIdx}
        ]]>
   </select>

    <!-- 공휴일 가져오기-->
    <select id="selectHolidayList" resultType="DochaHolidayDto" parameterType="DochaMap" >
   		<![CDATA[

                     SELECT
                               IFNULL(HOL_IDX                 , '' ) AS HOL_IDX
                        ,      IFNULL(RT_IDX                  , '' ) AS RT_IDX
                        ,      IFNULL(HOLIDAY_START_DT        , '' ) AS HOLIDAY_START_DT
                        ,      IFNULL(HOLIDAY_END_DT          , '' ) AS HOLIDAY_END_DT
                        ,      IFNULL(HOLIDAY_NAME            , '' ) AS HOLIDAY_NAME
                        ,      IFNULL(REG_ID                  , '' ) AS REG_ID
                        ,      IFNULL(MOD_ID                  , '' ) AS MOD_ID
                        ,      IFNULL(DEL_YN                  , '' ) AS DEL_YN
                        ,      IFNULL(THOL_IDX                , '' ) AS THOL_IDX
                     FROM DC_HOLIDAYS
                     WHERE RT_IDX = 'all'
                     AND (DEL_YN NOT IN ('Y') OR DEL_YN IS NULL)
                     AND ((HOLIDAY_START_DT <= #{holidayTime}
                    AND HOLIDAY_END_DT >= #{holidayTime})
                    OR (HOLIDAY_START_DT <= #{holidayTime}
                        AND HOLIDAY_END_DT >= #{holidayTime}))



        ]]>
   </select>

    <!-- 기간요금제 가져오기-->
    <select id="selectPeriodPaymentList" resultType="DochaPaymentPeriodDto" parameterType="DochaMap" >
   		<![CDATA[
                     SELECT
              IFNULL(PER_IDX, '')                        AS PER_IDX
             , IFNULL(PERIOD_START_DT, '')                 AS PERIOD_START_DT
             , IFNULL(PERIOD_END_DT, '')                         AS PERIOD_END_DT
             , IFNULL(DISCOUNT_EXTRACHARGE_CODE, '')                 AS DISCOUNT_EXTRACHARGE_CODE
             , IFNULL(PERIOD_PAY, '')                   AS PERIOD_PAY
             , IFNULL(CR_IDX, '')                   AS CR_IDX
             , IFNULL(DEL_YN, '')                   AS DEL_YN
                FROM DC_PAYMENT_PERIOD
                WHERE CR_IDX LIKE '%' #{crIdx} '%'
                AND (DEL_YN NOT IN ('Y') OR DEL_YN IS NULL)
                AND ((PERIOD_START_DT <= #{rentStartDay}
                    AND PERIOD_END_DT >= #{rentStartDay})
                    OR (PERIOD_START_DT <= #{rentEndDay}
                        AND PERIOD_END_DT >= #{rentEndDay}))


        ]]>
   </select>

    <!-- 기간요금제 가져오기-->
    <select id="selectPeriodPaymentListOnDaily" resultType="DochaPaymentPeriodDto" parameterType="DochaMap" >
   		<![CDATA[
                     SELECT
              IFNULL(PER_IDX, '')                        AS PER_IDX
             , IFNULL(PERIOD_START_DT, '')                 AS PERIOD_START_DT
             , IFNULL(PERIOD_END_DT, '')                         AS PERIOD_END_DT
             , IFNULL(DISCOUNT_EXTRACHARGE_CODE, '')                 AS DISCOUNT_EXTRACHARGE_CODE
             , IFNULL(PERIOD_PAY, '')                   AS PERIOD_PAY
             , IFNULL(CR_IDX, '')                   AS CR_IDX
             , IFNULL(DEL_YN, '')                   AS DEL_YN
                FROM DC_PAYMENT_PERIOD
                WHERE CR_IDX LIKE '%' #{crIdx} '%'
                AND (DEL_YN NOT IN ('Y') OR DEL_YN IS NULL)
                AND ((PERIOD_START_DT <= #{periodRentStartDay}
                    AND PERIOD_END_DT >= #{periodRentStartDay})
                    OR (PERIOD_START_DT <= #{periodRentStartDay}
                        AND PERIOD_END_DT >= #{periodRentStartDay}))


        ]]>
   </select>


    <!-- 차량 옵션 리스트 -->
    <select id="selectOptionCarList" parameterType="DochaMap" resultType="DochaCarInfoDto">
   		<![CDATA[





                                                               SELECT T1.CR_IDX 								AS CR_IDX
                                                                  ,      IFNULL(GROUP_CONCAT(T2.OPTION_DETAIL_CODE), '') AS OPTION_DETAIL_CODE

                                                              FROM   DC_CAR_INFO T1
                                                                   LEFT OUTER JOIN DC_CAR_INFO_OPTION T2
                                                              ON T1.CR_IDX = T2.CR_IDX

                                                              WHERE T1.CR_IDX = #{crIdx}




        ]]>

   </select>


</mapper>


